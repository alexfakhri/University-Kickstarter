

<h1> This page displays all of the projects on the site </h1>

<%= collection_select(:university, :name, @universities, :id, :name, {:prompt => true}, id: "uni-dropdown")%>

<%= text_field_tag :university, nil, placeholder: "Enter university name...", class: "typeahead" %> 


    <div class="container">
      <div class="row">
      <% if @projects.any? %>
    <% @projects.each do |project| %>
        <div class="col-md-4">
         <h2> <%= project.title %> </h2>
      <p> Description: <%= project.description %> </p>  
      <p> Target amount: <%= number_to_currency(project.target_amount, unit: :£) %></p>
          <p> Recent donations <% project.donations.each do |donation| %>
        <%= number_to_currency(donation.amount, unit: :£) %>
        <% end %></p>
        <p> Total donations so far <%= number_to_currency(project.total_donations, unit: :£) %></p>
          <p> <%= number_to_percentage(project.donation_percentage, precision: 0) %></p>
        <p> Number of backers <%= project.donations.count %></p> 
        <p> Number of UNIQUE backers <%= project.unique_donations %></p> 
          <p> Days left <%= project.days_left %></p>
      <p> <%= project.end_date.strftime("%d/%m/%Y") %></p>
      <p><%= link_to "Donate to project",  new_project_donation_path(project) %> </p>
    <% end %>
  <% else %>
    No projects yet
    </div>
  <% end %>
      </div>



<script type="text/javascript">

    var universities = <%= @universities.to_json.html_safe %>
$(document).ready(function() {
    // $("#uni-dropdown").bind('change', function() {
    //     var url = "/universities/"+ $(this).val()
    //         window.location.replace(url);
    // });

    // var universities = gon.universities

    //  $("h1").on('click', function() {
    //     alert(universities)
    //  });
    

    // var substringMatcher = function(strs) {
    //     return function findMatches(q, cb) {
    //     var matches, substrRegex;
     
    //     // an array that will be populated with substring matches
    //     matches = [];
     
    //     // regex used to determine if a string contains the substring `q`
    //     substrRegex = new RegExp(q, 'i');
     
    //     // iterate through the pool of strings and for any string that
    //     // contains the substring `q`, add it to the `matches` array
    //     $.each(strs, function(i, str) {
    //       if (substrRegex.test(str)) {
    //         // the typeahead jQuery plugin expects suggestions to a
    //         // JavaScript object, refer to typeahead docs for more info
    //         matches.push({ value: str });
    //       }
    //     });
     
    //     cb(matches);
    //   };
    // };

    var findMatches = function(query, cb){
        console.log(universities);
        cb(universities);
    }

    // var universities = new Bloodhound({
    //     remote: {
    //         url: '/projects',
    //     }
    // });

    // universities.initialize();


    $('.typeahead').typeahead({
      hint: true,
      highlight: true,
      minLength: 1
    },
    {
      name: 'universities',
      displayKey: 'name',
      source: findMatches,
      templates: {
        suggestion: Handlebars.compile('<p><a href="/universities/{{id}}">{{name}}</a></p>')
      }

    });

    // $(".typeahead").bind('change', function() {
    //     var url = "/universities/"+ $(this).val()
    //         window.location.replace(url);
    // });


});
</script>


