
 <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
      </ol>
      <div class="carousel-inner" role="listbox">
        <div class="item active">
          <img src="http://placehold.it/1900x1080&text=Slide" alt="First slide">
          <div class="container">
            <div class="carousel-caption">
              <h1>Example headline.</h1>
              <p>Note: If you're viewing this page via a <code>file://</code> URL, the "next" and "previous" Glyphicon buttons on the left and right might not load/display properly due to web browser security rules.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a></p>
            </div>
          </div>
        </div>
        <div class="item">
          <img src="http://placehold.it/1900x1080&text=Slide" alt="Second slide">
          <div class="container">
            <div class="carousel-caption">
              <h1>Another example headline.</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
            </div>
          </div>
        </div>
        <div class="item">
          <img src="http://placehold.it/1900x1080&text=Slide" alt="Third slide">
          <div class="container">
            <div class="carousel-caption">
              <h1>One more for good measure.</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
            </div>
          </div>
        </div>
      </div>
      <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>

<h2>Current University Projects</h2>

<form class="form-horizontal" role="form">
  <div class="form-group form-group-lg">
    <label class="col-sm-2 control-label" for="formGroupInputLarge"></label>
    <div class="col-sm-10">
      <input class="form-control" type="text" id="formGroupInputLarge" placeholder="Search projects by University">
    </div>
  </div>
</form>

<h2>Current University Projects</h2>

<%= collection_select(:university, :name, @universities, :id, :name, {:prompt => true}, id: "uni-dropdown")%>
<%= text_field_tag :university, nil, placeholder: "Enter university name...", class: "typeahead" %>
<div class="container">
  <div class="row">
    <% if @projects.any? %>
    <% @projects.each do |project| %>
    <div class="col-sm-6 col-md-4">
      <div class="thumbnail">
        <%= image_tag project.image.url(:large) %>
        <div class="caption">
          <h3> <%= link_to project.title, project_path(project) %> </h3>
          <p><%= truncate(project.description, :length => 200) %></p>
          <p>Fundraising ends:<strong><%= project.end_date.strftime("%d/%m/%Y") %></strong></p>
          <p class><h3><%= number_to_currency(project.target_amount, unit: :£) %> target</h3></p>
          <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%= number_to_percentage(project.donation_percentage, precision: 0) %>">
              <%= number_to_percentage(project.donation_percentage, precision: 0) %>
            </div>
          </div>
          <section>
            <div class="col-md-4"><h4><%= number_to_currency(project.total_donations, unit: :£) %></h4>Donated</div>
            <div class="col-md-4"><h4><%= project.unique_donations %></h4>Backers</div>
            <div class="col-md-4"><h4><%= project.days_left %></h4>Days left</div>
          </section>
          </br>
          <div class="text-center donationbuttons">
          <%= link_to "View Project", project_path(project), class: "btn btn-primary" %>
          <%= link_to "Donate to project",  new_project_donation_path(project), class: "btn btn-success" %>
          </div>
        </div>
      </div>
    </div>
    <% end %>
    <% else %>
    No projects yet
    <% end %>
  </div>
</div>

<script type="text/javascript">

$(document).ready(function() {
    $("#uni-dropdown").bind('change', function() {
        var url = "/universities/"+ $(this).val()
            window.location.replace(url);
    });


    var substringMatcher = function(universities) {
        return function findMatches(query, callback) {

        var substrRegex = new RegExp(query, 'i');
        var matches = [];

        $.each(universities, function(i, university) {
          if (substrRegex.test(university.name)) {
            matches.push(university);
          }
        });

        callback(matches);
        console.log(matches)
      };
    };

    var universities = <%= @universities.to_json.html_safe %>

    $('.typeahead').typeahead({
      hint: true,
      highlight: true,
      minLength: 1
    },
    {
      name: 'universities',
      displayKey: 'name',
      source: substringMatcher(universities),
      templates: {
        suggestion: Handlebars.compile('<p><a href="/universities/{{id}}">{{name}}</a></p>')
      }

    });

    //THIS SHIT WORKS:

    // var universities = <%= @universities.to_json.html_safe %>

    // var findMatches = function(query, cb){
    //     console.log(universities);
    //     cb(universities);
    // }

    // $('.typeahead').typeahead({
    //   hint: true,
    //   highlight: true,
    //   minLength: 1
    // },
    // {
    //   name: 'universities',
    //   displayKey: 'name',
    //   source: findMatches,
    //   templates: {
    //     suggestion: Handlebars.compile('<p><a href="/universities/{{id}}">{{name}}</a></p>')
    //   }

    // });

});
</script>


